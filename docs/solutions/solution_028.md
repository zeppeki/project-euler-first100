# Problem 028: Number spiral diagonals

## 問題

数字1から始めて時計回りに右に移動していき、次のような5×5の螺旋を形成する：

```
21 22 23 24 25
20  7  8  9 10
19  6  1  2 11
18  5  4  3 12
17 16 15 14 13
```

対角線上の数字の和が101であることが確認できる。

同じ方法で形成される1001×1001の螺旋において、対角線上の数字の和はいくつか？

## 解答

Project Euler公式サイトで確認してください。

## 解法

### 1. 素直な解法 (Naive Approach)

実際に螺旋を構築して対角線の和を計算する方法。

**アルゴリズム：**
1. n×n の2次元配列を作成
2. 中心から開始して時計回りに数字を配置
3. 方向は右→下→左→上の順で変更
4. 各方向で同じ歩数を2回繰り返してから歩数を増加
5. 対角線の要素を合計（中心は重複を除く）

**計算量：**
- 時間計算量: O(n²) - 全ての要素を配置
- 空間計算量: O(n²) - 2次元配列を格納

### 2. 最適化解法 (Optimized Approach)

螺旋の規則性を利用して対角線の値を直接計算する方法。

**アルゴリズム：**
1. 螺旋は層（ring）で構成されることを利用
2. 各層で4つの角の値を計算
3. k層目の4つの角の値は既知のパターンに従う
4. 角の値を直接計算して合計

**螺旋の層構造：**
- 中心：1
- 1層目：3, 5, 7, 9
- 2層目：13, 17, 21, 25
- k層目：各角の値は2k間隔で配置

**計算量：**
- 時間計算量: O(n) - 各層を1回ずつ処理
- 空間計算量: O(1) - 定数領域のみ使用

### 3. 数学的解法 (Mathematical Approach)

螺旋の対角線要素の数学的パターンから公式を導出する方法。

**数学的分析：**

各層での4つの角の値を分析すると：
- k層目（k≥1）の4つの角：
  - 右上：(2k+1)² - 2k = 4k² + 1
  - 右下：(2k+1)² = 4k² + 4k + 1
  - 左下：(2k+1)² - 4k = 4k² - 4k + 1
  - 左上：(2k+1)² - 6k = 4k² - 2k + 1

- k層目の4つの角の合計：16k² + 4k + 4

**公式導出：**

n×n螺旋（n=2m+1）の対角線の和：
```
Sum = 1 + Σ(k=1 to m) (16k² + 4k + 4)
    = 1 + 16·Σk² + 4·Σk + 4·m
    = 1 + 16·m(m+1)(2m+1)/6 + 4·m(m+1)/2 + 4·m
```

ここで m = (n-1)/2 = (size-1)/2

**計算量：**
- 時間計算量: O(1) - 公式による直接計算
- 空間計算量: O(1) - 定数領域のみ使用

## 実装のポイント

### 螺旋の構築方向
時計回りの螺旋は以下の方向パターンで構築：
1. 右 (0, 1)
2. 下 (1, 0)
3. 左 (0, -1)
4. 上 (-1, 0)

### 歩数の増加パターン
- 1歩 → 1歩 → 2歩 → 2歩 → 3歩 → 3歩 → ...
- 同じ歩数を2回繰り返してから増加

### エラーハンドリング
- サイズは奇数のみ有効（螺旋の中心が必要）
- 偶数サイズはValueErrorを発生

## 学習ポイント

1. **パターン認識**: 螺旋の規則性を理解して最適化
2. **数学的解析**: 等差数列の和の公式の応用
3. **計算量改善**: O(n²) → O(n) → O(1) への最適化
4. **空間効率**: 実際の配列構築を回避した定数空間解法

## 検証

- **入力**: 1001×1001
- **解答**: [隠匿]
- **検証**: ✓ 全解法で一致

## パフォーマンス

1001×1001螺旋での実行時間比較：
- 最適化解法: ~0.0002秒
- 数学的解法: ~0.000001秒（約200倍高速）
