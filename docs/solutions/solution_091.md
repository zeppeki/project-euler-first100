# Problem 91: Right triangles with integer coordinates

## 問題の概要

点P (x₁, y₁) と Q (x₂, y₂) を整数座標にプロットし、原点O(0,0)と結んで三角形OPQを形成します。

各座標が0以上2以下の場合（0 ≤ x₁, y₁, x₂, y₂ ≤ 2）、直角を含む三角形はちょうど14個形成できます。

0 ≤ x₁, y₁, x₂, y₂ ≤ 50 の条件で、何個の直角三角形を形成できるでしょうか？

## 解法の解説

### 1. 素直な解法：全探索

最も直感的なアプローチは、すべての可能な点の組み合わせを試し、直角三角形かどうかを判定することです。

```python
def is_right_triangle(x1, y1, x2, y2):
    # 3辺の長さの2乗を計算
    op_sq = x1 * x1 + y1 * y1
    oq_sq = x2 * x2 + y2 * y2
    pq_sq = (x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1)

    # ピタゴラスの定理で判定
    return (op_sq + oq_sq == pq_sq or  # O が直角
            op_sq + pq_sq == oq_sq or  # P が直角
            oq_sq + pq_sq == op_sq)    # Q が直角
```

- **時間計算量**: O(n⁴) - 4つのネストしたループ
- **空間計算量**: O(1)

### 2. 最適化解法：重複の排除

PとQの順序は関係ないため、重複を避けることで計算量を半分に削減できます。

```python
# 辞書順で P < Q となる場合のみカウント
if (x1, y1) < (x2, y2) and is_right_triangle(x1, y1, x2, y2):
    count += 1
```

- **時間計算量**: O(n⁴) だが定数倍が改善
- **空間計算量**: O(1)

### 3. 数学的考察

直角三角形は以下の3つのケースに分類できます：

1. **原点Oで直角の場合**
   - OP ⊥ OQ となる条件は、ベクトルの内積が0
   - OP・OQ = x₁x₂ + y₁y₂ = 0
   - 最も単純なケースは、一方がx軸上、もう一方がy軸上

2. **点Pで直角の場合**
   - PO ⊥ PQ となる条件を満たす点Qを探す
   - Pを通り、POに垂直な直線上の格子点

3. **点Qで直角の場合**
   - QO ⊥ QP となる条件（Pで直角の場合と対称）

## 実装のポイント

1. **三角形の判定条件**
   - 3点が異なる点である（同じ点や原点は除外）
   - 3点が一直線上にない

2. **ピタゴラスの定理の適用**
   - a² + b² = c² を満たすかチェック
   - どの頂点が直角になるか3通り確認

3. **整数演算の利点**
   - 浮動小数点の誤差を避けられる
   - 距離の2乗のまま比較可能

## 計算例

### 2×2グリッドの場合

```
座標: (0,0), (0,1), (0,2), (1,0), (1,1), (1,2), (2,0), (2,1), (2,2)

直角三角形の例:
- O(0,0), P(1,0), Q(0,1) - 原点で直角
- O(0,0), P(1,0), Q(1,1) - Pで直角
- O(0,0), P(2,0), Q(2,1) - Qで直角
...

合計: 14個
```

## 解答

Project Euler公式サイトで確認してください。

## 検証

- **入力:** 0 ≤ x₁, y₁, x₂, y₂ ≤ 50
- **解答:** [隠匿]
- **検証:** ✓

## 学習ポイント

1. **計算幾何の基礎**
   - ベクトルの内積を使った垂直判定
   - ピタゴラスの定理の応用

2. **組み合わせの最適化**
   - 対称性を利用した重複の排除
   - 順序付けによる効率化

3. **整数座標の利点**
   - 正確な計算が可能
   - 浮動小数点誤差の回避

4. **問題の分類**
   - 直角の位置による場合分け
   - それぞれのケースの特徴を理解

## 関連する問題

- Problem 15: Lattice paths（格子点の問題）
- Problem 102: Triangle containment（三角形の判定）
- その他の計算幾何問題
