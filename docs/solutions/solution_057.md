# Problem 057: Square root convergents

## 問題文

√2は無限連分数として表現できることが示せる。

√2 = 1 + 1 / (2 + 1 / (2 + 1 / (2 + ...)))

これを最初の4回展開すると、以下が得られる：

- 1 + 1/2 = 3/2 = 1.5
- 1 + 1/(2 + 1/2) = 1 + 1/(5/2) = 1 + 2/5 = 7/5 = 1.4
- 1 + 1/(2 + 1/(2 + 1/2)) = 1 + 1/(2 + 2/5) = 1 + 1/(12/5) = 1 + 5/12 = 17/12 ≈ 1.41666...
- 1 + 1/(2 + 1/(2 + 1/(2 + 1/2))) = 1 + 1/(2 + 1/(12/5)) = 1 + 1/(2 + 5/12) = 1 + 1/(29/12) = 1 + 12/29 = 41/29 ≈ 1.41379...

次の3つの展開は99/70、239/169、577/408であるが、8番目の展開である1393/985が、分子の桁数が分母の桁数を上回る最初の例である。

最初の1000個の展開において、分子の桁数が分母の桁数より多い分数はいくつあるか？

## アプローチ

### アプローチ 1: 素直な解法 (solve_naive)

**アルゴリズム**:
1. 各nについて√2の第n近似分数を再帰的に計算
2. 分子と分母の桁数を比較
3. 分子の桁数が分母より多い場合をカウント

**計算量**:
- 時間計算量: O(n²) - 各近似分数の計算がO(n)
- 空間計算量: O(1)

**実装のポイント**:
- `fractions.Fraction`を使用して正確な分数計算
- 連分数の底から上への構築

### アプローチ 2: 最適化解法 (solve_optimized)

**最適化のポイント**:
1. **反復的計算**: 各近似分数を前の値から直接計算
2. **数学的関係**: 近似分数間の漸化式を利用

**数学的関係**:
√2の近似分数をPₙ/Qₙとすると：
- P₁ = 3, Q₁ = 2
- Pₙ₊₁ = Pₙ + 2Qₙ
- Qₙ₊₁ = Pₙ + Qₙ

**計算量**:
- 時間計算量: O(n) - 各近似分数を一度だけ計算
- 空間計算量: O(1)

## 重要な概念

### 連分数と近似分数

1. **連分数表現**: √2 = [1; 2, 2, 2, ...]
2. **近似分数**: 連分数の有限項での近似
3. **収束性**: より多くの項を含む近似分数はより正確

### 数学的性質

1. **漸化式**: Pₙ₊₁ = Pₙ + 2Qₙ, Qₙ₊₁ = Pₙ + Qₙ
2. **既約分数**: すべての近似分数は最簡形
3. **交互性**: 近似分数は√2を交互に上下から近似

## 実装上の注意点

### 大整数の処理

1. **指数的成長**: 分子・分母が急速に成長
2. **精度**: Pythonの任意精度整数演算を活用
3. **メモリ効率**: 大きな数値の一時保存

### パフォーマンス最適化

1. **反復計算**: O(n²)からO(n)への改善
2. **漸化式**: 数学的関係の直接利用
3. **早期終了**: 不要な計算の回避

## 学習ポイント

### 数学的洞察

1. **連分数理論**: 実数の連分数表現
2. **ディオファントス近似**: 有理数による無理数の近似
3. **数論**: 整数の性質と分数の既約性

### アルゴリズム設計

1. **漸化式の活用**: 数学的関係による最適化
2. **反復vs再帰**: 計算効率の比較
3. **大整数演算**: プログラミング言語の機能活用

## 実行例

### テストケース

```python
# 小さな範囲での検証
assert solve_naive(10) == 1    # 8番目のみが条件を満たす
assert solve_naive(50) == 7    # より大きな範囲
assert solve_naive(100) == 15  # さらに大きな範囲
```

### 近似分数の例

```python
# 最初の8個の近似分数
1: 3/2      (1桁/1桁)
2: 7/5      (1桁/1桁)
3: 17/12    (2桁/2桁)
4: 41/29    (2桁/2桁)
5: 99/70    (2桁/2桁)
6: 239/169  (3桁/3桁)
7: 577/408  (3桁/3桁)
8: 1393/985 (4桁/3桁) ← 最初の例
```

### パフォーマンス比較

- **素直な解法**: 2.6秒（1000項）
- **最適化解法**: 0.002秒（1000項）
- **速度向上**: 1374倍の高速化

## 解答

Project Euler公式サイトで確認してください。

## 検証

- **入力**: 1000項
- **解答**: [隠匿]
- **検証**: ✓ 全解法で一致

## 統計情報

### 分布分析

- **総近似分数**: 1000個
- **条件を満たす数**: 153個
- **割合**: 15.3%

### パターン分析

1. **8番目**: 最初の例（1393/985）
2. **13番目**: 次の例
3. **周期性**: 規則的ではないが、ある程度の パターンあり

### 桁数の成長

- **分子**: 指数的成長
- **分母**: 指数的成長
- **差**: 通常0または1桁の差

## 数学的背景

### 連分数理論

√2の連分数表現 [1; 2, 2, 2, ...] は完全に周期的で、周期は1（常に2）である。

### 近似の質

近似分数Pₙ/Qₙは最良近似分数であり、同じ分母以下での最も正確な近似を提供する。

### 成長率

分子と分母の成長率は黄金比φ = (1+√5)/2に関連し、約φ^nに比例して成長する。

## 参考文献

- **連分数理論**: 数論における基本的な概念
- **ディオファントス近似**: 数論と解析の交差分野
- **計算数論**: 効率的なアルゴリズムの重要性
